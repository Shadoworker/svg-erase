<!DOCTYPE html>

<html>
<head>
	<title> func_test </title>
	<script src="erase.js"> </script>
</head>

<body>
	<script>
	
	/*
	* Test get_elements
	*
	var arr = ['a', 'b', 'c', 'd'];
	document.write( "original: " + arr + "<br />" );
	var sub_arr = get_elements( arr, 1, 3 );
	document.write( "\"slice\": " + sub_arr + "<br />" );
	document.write( "original again: " + arr + "<br />" );
	*/
	
	/*
	* Test get_distance
	*
	var p0 = [0, 0];
	var p1 = [1, 1];
	var p2 = [2, 0];
	var p3 = [2, 2];
	var p4 = [0, 5];
	document.write( get_distance( p0[0], p0[1], p1[0], p1[1] ) + "<br />");
	document.write( get_distance( p0[0], p0[1], p2[0], p2[1] ) + "<br />");
	document.write( get_distance( p0[0], p0[1], p3[0], p3[1] ) + "<br />");
	document.write( get_distance( p0[0], p0[1], p4[0], p4[1] ) + "<br />");
	*/
	
	/*
	* Test within_circle
	*
	var c = [0, 0];
	var r = 4;
	var p1 = [-1, -1];
	var p2 = [2, 0];
	var p3 = [2, 2];
	var p4 = [0, 5];
	document.write( within_circle( p1[0], p1[1], c[0], c[1], r ) + "<br />" );
	document.write( within_circle( p2[0], p2[1], c[0], c[1], r ) + "<br />" );
	document.write( within_circle( p3[0], p3[1], c[0], c[1], r ) + "<br />" );
	document.write( within_circle( p4[0], p4[1], c[0], c[1], r ) + "<br />" );
	*/
	
	/*
	* Test within_box
	*
	var a = [-2, 0];
	var b = [2, 0];
	var r = 2;
	var p1 = [-1, -1];
	var p2 = [2, 0];
	var p3 = [1.5, 0.5];
	var p4 = [0, 3];	
	document.write( within_box( p1[0], p1[1], a[0], a[1], b[0], b[1], r ) + "<br />" );
	document.write( within_box( p2[0], p2[1], a[0], a[1], b[0], b[1], r ) + "<br />" );
	document.write( within_box( p3[0], p3[1], a[0], a[1], b[0], b[1], r ) + "<br />" );
	document.write( within_box( p4[0], p4[1], a[0], a[1], b[0], b[1], r ) + "<br />" );
	
	var c = [0, 0];
	var d = [3, 3];
	var r = 2;
	var p1 = [-1, -1];
	var p2 = [2, 0];
	var p3 = [1.5, 0.5];
	var p4 = [0, 3];
	document.write( within_box( p1[0], p1[1], c[0], c[1], d[0], d[1], r ) + "<br />" );
	document.write( within_box( p2[0], p2[1], c[0], c[1], d[0], d[1], r ) + "<br />" );
	document.write( within_box( p3[0], p3[1], c[0], c[1], d[0], d[1], r ) + "<br />" );
	document.write( within_box( p4[0], p4[1], c[0], c[1], d[0], d[1], r ) + "<br />" );
	*/
	
	/*
	* Test within_capsule
	*
	var a = [-4, 0];
	var b = [4, 0];
	var r = 2;
	var p1 = [-5, 0]; // 1, 0, 0
	var p2 = [-6, 0]; // 0, 0, 0
	var p3 = [0, 0];  // 0, 0, 1
	var p4 = [3, 0];  // 0, 1, 1
	var p5 = [0, 4];  // 0, 0, 0
	document.write( within_capsule( p1[0], p1[1], a[0], a[1], b[0], b[1], r ) + "<br />" );
	document.write( within_capsule( p2[0], p2[1], a[0], a[1], b[0], b[1], r ) + "<br />" );
	document.write( within_capsule( p3[0], p3[1], a[0], a[1], b[0], b[1], r ) + "<br />" );
	document.write( within_capsule( p4[0], p4[1], a[0], a[1], b[0], b[1], r ) + "<br />" );
	document.write( within_capsule( p5[0], p5[1], a[0], a[1], b[0], b[1], r ) + "<br />" );
	*/
	
	/*
	* Test get_parallel_segments
	*
	var a = [-4, 0];
	var b = [4, 0];
	var r = 2;
	var pts = get_parallel_segments( a[0], a[1], b[0], b[1], r );
	document.write( pts[0] + "; " + pts[1] + "; " + pts[2] + "; " + pts[3] + "<br />" );
	
	var c = [0, 0];
	var d = [4, 4];
	var pts2 = get_parallel_segments( c[0], c[1], d[0], d[1], r );
	document.write( pts2[0] + "; " + pts2[1] + "; " + pts2[2] + "; " + pts2[3] + "<br />" );
	*/
	
	/*
	* Test get_circle_intersection
	*
	var c = [0, 0];
	var r = 3;
	var a = [-1, 0];
	var b = [5, 0];
	document.write( get_circle_intersection( a[0], a[1], b[0], b[1], c[0], c[1], r ) + "<br />" );
	
	var d = [-1, -1];
	document.write( get_circle_intersection( d[0], d[1], b[0], b[1], c[0], c[1], r ) + "<br />" );
	*/
	
	/*
	* Test get_circle_intersections
	*
	var c = [0,0];
	var r = 3;
	var a = [-4, 0];
	var b = [4, 0];
	var d = [-4, 1];
	var e = [4, 1];
	document.write( get_circle_intersections( d[0], d[1], e[0], e[1], c[0], c[1], r ) + "<br />" );
	*/
	
	/*
	* Test get_line_intersection
	*
	var p0 = [-2, 0];
	var p1 = [2, 0];
	var p2 = [0, 2];
	var p3 = [0, -2];
	document.write( get_line_intersection( p0[0], p0[1], p1[0], p1[1], p2[0], p2[1], p3[0], p3[1] ) + "<br />" );
	
	var p4 = [0, 0];
	var p5 = [10, 10];
	var p6 = [4, 0];
	var p7 = [7, 20];
	document.write( get_line_intersection( p4[0], p4[1], p5[0], p5[1], p6[0], p6[1], p7[0], p7[1] ) + "<br />" );
	*/
	
	/*
	* Test get_capsule_intersection
	*
	var c0 = [-4, 0];
	var c1 = [4, 0];
	var r = 2;
	var p0 = [3, 1];
	var p1 = [6, 1];
	var p2 = [-7, 0];
	
	var code = within_capsule( p0[0], p0[1], c0[0], c0[1], c1[0], c1[1], r );
	
	var intersection1 = get_capsule_intersection( p0[0], p0[1], code, p1[0], p1[1], c0[0], c0[1], c1[0], c1[1], r );
	document.write( intersection1 + "<br />" );
	var intersection2 = get_capsule_intersection( p0[0], p0[1], code, p2[0], p2[1], c0[0], c0[1], c1[0], c1[1], r );
	document.write( intersection2 + "<br />" );
	*/
	
	/*
	* Test get_capsule_intersections
	*
	var c0 = [-4, 0];
	var c1 = [4, 0];
	var r = 2;
	
	var p0 = [-1, -10];
	var p1 = [2, 7];
	
	var p2 = [-7, 0];
	var p3 = [7, 0];
	
	var p4 = [-7, -10];
	var p5 = [-7, 10];
	
	var intersections0 = get_capsule_intersections( p0[0], p0[1], p1[0], p1[1], c0[0], c0[1], c1[0], c1[1], r );
	var intersections1 = get_capsule_intersections( p2[0], p2[1], p3[0], p3[1], c0[0], c0[1], c1[0], c1[1], r );
	var intersections2 = get_capsule_intersections( p4[0], p4[1], p5[0], p5[1], c0[0], c0[1], c1[0], c1[1], r );
	
	document.write( intersections0 + "<br />" );
	document.write( intersections1 + "<br />" );
	document.write( intersections2 + "<br />" );
	*/
	
	/*
	* Test handle_clean_erase
	*
	erase_path = [[263,258],[263,258],[263,258],[263,259],[262,259],[262,259],[262,259],[261,259],[261,259],[261,260],[261,260],[261,260],[261,260],[260,260],[260,261],[260,261],[260,261],[260,261],[260,261],[260,262],[260,262],[260,262],[260,263],[260,263],[260,263],[260,263],[260,263],[260,263]];
	document.write( erase_path );
	var handle_clean_erase = function(e_path) {
		document.write( "<br />" + e_path.length );
		var clean_erase = []; 
		if ( e_path.length === 1 ) {
			document.write( "<br />check" );
			clean_erase = e_path;
		}
		else {
			var eClean = 0;
			while ( eClean < (e_path.length-1) ) {
				document.write( "<br />eClean: " + eClean + "erase_path[eClean]: " + e_path[eClean] + ", erase_path[eClean+1]: " + e_path[eClean+1] + " " );
				document.write( (e_path[eClean][0] !== e_path[eClean+1][0]) + ", " + (e_path[eClean][1] !== e_path[eClean+1][1]) );
				if ( e_path[eClean][0] !== e_path[eClean+1][0] || e_path[eClean][1] !== e_path[eClean+1][1] ) {
					//document.write( "eClean: " + eClean + ", new_point: " + e_path[eClean] + "<br />" );
					clean_erase.push( e_path[eClean] );
			    }
				eClean++;
			}
			if ( e_path.length !== 0 && clean_erase.length === 0 ) {
				clean_erase.push( e_path[0] );
			}
			if ( e_path[e_path.length-1][0] !== e_path[clean_erase.length-1][0] && e_path[e_path.length-1][1] !== e_path[clean_erase.length-1][1] ) {
				clean_erase.push( e_path[eClean] );
			}
		}
		//document.write( "<br />cleaned: " + clean_erase )
		return clean_erase;
	}
	
	var handle_clean_path = function( path ) {
		var clean_path = [];
		if ( path.length === 1 ) {
			clean_path = path;
		}
		else {
			pClean = 0;
			while ( pClean < (path.length-1) ) {
				if ( path[pClean][0] !== path[pClean+1][0] || path[pClean][1] !== path[pClean+1][1] ) {
					clean_path.push( path[pClean] );
				}
				pClean++;
			}
			if ( path.length !== 0 && clean_path.length === 0 ) {
				clean_path.push( path[0] );
			}
			if ( path[path.length-1][0] !== path[clean_path.length-1][0] || path[path.length-1][1] !== path[clean_path.length-1][1] ) {
				clean_path.push( path[pClean] );
		    }
		}
		return clean_path;
	}
	
	erase_path = handle_clean_path( erase_path );
	document.write( "<br />" + erase_path );
	
	erase_path2 = [[0, 0], [100, 100]];
	erase_path3 = [[0, 0], [0, 0]];
	erase_path4 = [[1, 1]];
	
	erase_path2 = handle_clean_path( erase_path2 );
	document.write( "<br /> erase_path2 " + erase_path2 );
	erase_path3 = handle_clean_path( erase_path3 );
	document.write( "<br /> erase_path3 " + erase_path3 );
	erase_path4 = handle_clean_path( erase_path4 );
	document.write( "<br /> erase_path4 " + erase_path4 );
	*/
	
	/*
	* Test thing
	*
	var arr = [1, 2, 3];
	var thing = function( a ) {
		var barr = [];
		barr.push( a[0] );
		return barr;
	}
	document.write( "<br />" + arr );
	arr = thing( arr );
	document.write( "<br />" + arr );
	*/
	
	
	/*
	* Test erase!!!
	*/
	var paths = [[[100, 50], [300,50]]];
	var erase_path = [[200, 30], [200, 100]];
	var new_paths = [];
	var erase_radius = 6;
	document.write( "paths: " + paths + "<br />" );
	document.write( "erase_path: " + erase_path + "<br />" );
	/*
	var handle_path_clean = function( path ) {
		var clean_path = [];
		if ( path.length === 1 ) {
			clean_path = path;
		}
		else {
			pClean = 0;
			while ( pClean < (path.length-1) ) {
				if ( path[pClean][0] !== path[pClean+1][0] || path[pClean][1] !== path[pClean+1][1] ) {
					clean_path.push( path[pClean] );
				}
				pClean++;
			}
			if ( path.length !== 0 && clean_path.length === 0 ) {
				clean_erase.push( path[0] );
			}
			if ( path[path.length-1][0] !== path[clean_path.length-1][0] || path[path.length-1][1] !== path[clean_path.length-1][1] ) {
				clean_path.push( path[pClean] );
		    }
		}
		return clean_path;
	}
	*/
	//var new_paths = handle_path_clean( paths[0] );
	//erase_path = handle_path_clean( erase_path );
	
	var handle_capsule_erase = function(path, i) {
		var e0 = erase_path[i];
		var e1 = erase_path[i+1];
		
		var i = 0;
		var last = 0;
		
		//document.write ( "*** " + path + " ***" );
		
		// handle point path
		if ( path.length === 1 ) {
			var code = within_capsule( path[0][0], path[0][1], e0[0], e0[1], e1[0], e1[1], erase_radius );
			if ( code.indexOf( 1 ) !== -1 ) {
				//document.write( "point path pushed: " + path + "<br />" );
				new_paths.push( path );
				return;
			}
		}
		var new_path;
		while ( i < (path.length - 1) ) {
			var p0 = path[i];
			var p1 = path[i+1];
			var code0 = within_capsule( p0[0], p0[1], e0[0], e0[1], e1[0], e1[1], erase_radius );
			var code1 = within_capsule( p1[0], p1[1], e0[0], e0[1], e1[0], e1[1], erase_radius );
			
			if ( code0.indexOf( 1 ) !== -1 && code1.indexOf( 1 ) !== -1 ) {
				i++;
				last = i;
			}
			else if ( code0.indexOf( 1 ) !== -1 && code1.indexOf( 1 ) === -1 ) {
				var x = get_capsule_intersection( p0[0], p0[1], code0, p1[0], p1[1], e0[0], e0[1], e1[0], e1[1], erase_radius );
				path[i] = x;
				last = i;
			}
			else if ( code0.indexOf( 1 ) === -1 && code1.indexOf( 1 ) !== -1 ) {
				var x = get_capsule_intersection( p1[0], p1[0], code1, p0[0], p0[1], e0[0], e0[1], e1[0], e1[1], erase_radius );
				new_path = get_elements( path, last, i+1 );
				new_path.push( x );
				new_paths.push( new_path );
				i++;
				last = i;
			}
			else {
				var poss_intersects = get_capsule_intersections( p0[0], p0[1], p1[0], p1[1], e0[0], e0[1], e1[0], e1[1], erase_radius );
				if ( poss_intersects ) {
					new_path = get_elements( path, last, i+1 );
					new_path.push( poss_intersects[0] );
					new_paths.push( new_path );
					path[i] = poss_intersects[1];
					last = i;
				}
				else {
					i++;
				}
			}
		}
		if ( last !== i ) {
			new_path = get_elements( path, last, path.length );
			new_paths.push( new_path );
		}
	} // end handle_capsule_erase
	handle_capsule_erase( paths[0], 0 );
	document.write( "new_paths: " + new_paths + "<br />" );
	document.write( "erase_path: " + erase_path + "<br />" );
	
	// tests of more complicated input
	new_paths = [];
	paths = [[[727,152], [727,151], [725,150], [721,148], [713,144], [704,140], [692,137], [678,135], [667,134], [656,134], [646,134], [635,137], [625,142], [615,148], [603,159], [594,170], [585,181], [582,193], [577,210], [572,232], [567,266], [563,296], [563,319], [567,338], [573,353], [582,367], [591,377], [601,390], [615,398], [628,406], [642,411], [660,415], [677,417], [692,417], [707,417], [724,413], [743,407], [758,399], [769,388], [775,378], [781,365], [785,351], [790,335], [794,323], [794,312], [794,302], [791,293], [786,283], [782,276], [776,270], [771,264], [763,261], [750,256], [731,252], [713,244], [693,240], [670,238], [650,237], [638,237], [628,239], [621,244], [616,249], [611,257], [604,267], [601,277], [598,288], [598,301], [598,317], [601,333], [608,345], [619,361], [630,371], [639,381], [648,388], [656,393], [666,397], [673,398], [684,399], [696,400], [705,399], [716,393], [724,386], [730,378], [734,370], [737,363], [737,357], [737,350], [737,341], [734,335], [728,327], [723,324], [715,321], [709,320], [700,320], [693,320], [685,321], [678,324], [672,326], [667,328], [666,329], [666,330] ]];
	erase_path = [[600, 170], [600, 30]];
	document.write( "paths: " + paths + "<br />" );
	document.write( "erase_path: " + erase_path + "<br />" );
	handle_capsule_erase( paths[0], 0 );
	document.write( "[" );
	for ( var i = 0; i < new_paths[0].length; i++ ) {
		document.write( "[" + new_paths[0][i][0] + "," + new_paths[0][i][1] + "], " );
	}
	document.write( "]<br />" );
	//document.write( "new_paths: " + new_paths + "<br />" );
	document.write( "erase_path: " + erase_path + "<br />" );
	/**/
	/*
	if ( null ) document.write( "checks out <br />" );
	else document.write( "no <br />" );
	*/
	
	</script>
</body>

</html>